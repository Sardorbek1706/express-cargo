<!DOCTYPE html>
<html lang="en">

<head>
  <%- include('../partials/head'); %>
    <title>All Blogs</title>
</head>

<body class="container py-4">
  <header><%- include('../partials/header'); %></header>
  <main class="flex-grow-1">
    <div class="bg-light p-5 rounded-3 mb-4 shadow-sm">
      <h1 class="mb-4 text-primary">All Blog Posts</h1>
      <% if (typeof successMessage !=='undefined' && successMessage) { %>
        <div class="alert alert-success alert-dismissible fade show" role="alert">
          <%= successMessage %>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        <% } %>

          <a href="/blog/new" class="btn btn-success mb-3">Create New Blog</a>

          <form action="/blog" method="GET" class="mb-4">
            <div class="input-group">
              <input type="text" class="form-control" name="search" placeholder="Search blogs..." value="<%= search %>">
              <button class="btn btn-outline-secondary" type="submit">Search</button>
            </div>
          </form>

          <% if (blogs && blogs.length> 0) { %>
            <ul class="list-group">
              <% blogs.forEach(blog=> { %>
                <li class="list-group-item d-flex justify-content-between align-items-center mb-2">
                  <a href="/blog/<%= blog._id %>" class="text-decoration-none h5 mb-0 text-dark">
                    <%= blog.title %>
                  </a>
                  <div class="d-flex align-items-center">
                    <span class="badge bg-secondary rounded-pill me-2">
                      <%= new Date(blog.createdAt).toLocaleDateString() %>
                    </span>
                    <a href="/blog/<%= blog._id %>/edit" class="btn btn-sm btn-warning me-2">Edit</a>
                    <form action="/blog/<%= blog._id %>?_method=DELETE" method="POST"
                      onsubmit="return confirm('Are you sure you want to delete this blog?');">
                      <button type="submit">Delete Blog</button>
                    </form>
                  </div>
                </li>
                <% }); %>
            </ul>

            <nav aria-label="Page navigation" class="mt-4">
              <ul class="pagination justify-content-center">
                <li class="page-item <%= currentPage === 1 ? 'disabled' : '' %>">
                  <a class="page-link" href="/blog?page=<%= currentPage - 1 %>&search=<%= search %>">Previous</a>
                </li>
                <% for (let i=1; i <=totalPages; i++) { %>
                  <li class="page-item <%= currentPage === i ? 'active' : '' %>">
                    <a class="page-link" href="/blog?page=<%= i %>&search=<%= search %>">
                      <%= i %>
                    </a>
                  </li>
                  <% } %>
                    <li class="page-item <%= currentPage === totalPages ? 'disabled' : '' %>">
                      <a class="page-link" href="/blog?page=<%= currentPage + 1 %>&search=<%= search %>">Next</a>
                    </li>
              </ul>
            </nav>

            <% } else { %>
              <div class="alert alert-info" role="alert">
                No blogs found.
              </div>
              <% } %>

    </div>
  </main>
  <footer class="mt-5"><%- include('../partials/footer'); %></footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>